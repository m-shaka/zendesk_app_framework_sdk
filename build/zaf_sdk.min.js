!function(){function require(e,t,n){t||(t=0);var r=require.resolve(e,t),i=require.m[t][r];if(!i)throw new Error('failed to require "'+e+'" from '+n);if(i.c&&(t=i.c,r=i.m,i=require.m[t][i.m],!i))throw new Error('failed to require "'+r+'" from '+t);return i.exports||(i.exports={},i.call(i.exports,i,i.exports,require.relative(r,t))),i.exports}require.resolve=function(e,t){var n=e,r=e+".js",i=e+"/index.js";return require.m[t][r]&&r?r:require.m[t][i]&&i?i:n},require.relative=function(e,t){return function(n){if("."!=n.charAt(0))return require(n,t,e);var r=e.split("/"),i=n.split("/");r.pop();for(var s=0;s<i.length;s++){var o=i[s];".."==o?r.pop():"."!=o&&r.push(o)}return require(r.join("/"),t,e)}},require.m=[],require.m[0]={version:{exports:"2.0.8"},"index.js":function(module,exports,require){var Client=require("client"),Utils=require("utils"),ZAFClient={};ZAFClient.init=function(callback){var client,queryParams=Utils.queryParameters(),hashParams=Utils.queryParameters((document.location.hash||"").slice(1)),origin=queryParams.origin||hashParams.origin,app_guid=queryParams.app_guid||hashParams.app_guid;return!(!origin||!app_guid)&&(client=new Client({origin:origin,appGuid:app_guid}),"function"==typeof callback&&client.on("app.registered",callback.bind(client)),client)},module.exports=ZAFClient},"utils.js":function(module,exports,require){function isObject(obj){return null!==obj&&"object"==typeof obj}function decode(s){return decodeURIComponent((s||"").replace(/\+/g," "))}function queryParameters(queryString){var keyValuePairs,keyAndValue,key,value,result={};if(queryString=queryString||(document.location.search||"").slice(1),0===queryString.length)return result;keyValuePairs=queryString.split("&");for(var i=0;i<keyValuePairs.length;i++)keyAndValue=keyValuePairs[i].split("="),key=decode(keyAndValue[0]),value=decode(keyAndValue[1])||"",result[key]=value;return result}function isPromise(obj){return obj instanceof Promise||!!obj&&obj.then&&"function"==typeof obj.then}function shouldReject(val){return val===!1||val instanceof Error||"string"==typeof val}function when(items){items=items||[];var resolveAll,rejectAll,allResolvedPromise=new Promise(function(resolve,reject){resolveAll=resolve,rejectAll=reject}),remaining=0,settledWith=[],itemsCopy=Array.isArray(items)?items.slice():[items],resolveWith=function(data,index){settledWith[index]=data,--remaining<=0&&resolveAll(settledWith)};return remaining=itemsCopy.length,remaining<=0?(resolveAll(),allResolvedPromise):(itemsCopy.forEach(function(item,index){var promise;if(isPromise(item))promise=item;else if("function"==typeof item){var res;try{res=item(),promise=isPromise(res)?res:shouldReject(res)?Promise.reject(res):Promise.resolve(res)}catch(err){promise=Promise.reject(err)}}else promise=new Promise(function(resolve,reject){shouldReject(item)?reject(item):resolve(item)});promise.then(function(data){resolveWith(data,index)})["catch"](rejectAll.bind(rejectAll))}),allResolvedPromise)}var Promise=window.Promise||require("../vendor/native-promise-only");module.exports={queryParameters:queryParameters,when:when,isObject:isObject}},"client.js":function(module,exports,require){function timeoutReject(reject,name,paramsArray){switch(name){case"invoke":var matches=paramsArray.filter(function(action){return PROMISE_DONT_TIMEOUT.indexOf(action)!==-1}),allWhitelisted=matches.length===paramsArray.length;if(allWhitelisted)return NaN;var notAllWhitelisted=0!==matches.length;if(notAllWhitelisted)throw new Error("Illegal bulk call - `instances.create` must be called separately.");return defaultTimer(reject);default:return defaultTimer(reject)}}function defaultTimer(callback){return setTimeout(function(){callback(new Error("Invocation request timeout"))},PROMISE_TIMEOUT)}function nextIdFor(name){return isNaN(ids[name])&&(ids[name]=0),++ids[name]}function rawPostMessage(client,msg,forceReady){client.ready||forceReady?client._source.postMessage(msg,client._origin):client.on("app.registered",rawPostMessage.bind(null,client,msg))}function wrappedPostMessage(name,params){var timeoutId,id=nextIdFor("promise"),promise=new Promise(function(resolve,reject){timeoutId=timeoutReject(reject,name,Array.isArray(params)?params:Object.keys(params)),pendingPromises[id]={resolve:resolve,reject:reject};var msg=JSON.stringify({id:id,request:name,params:params,appGuid:this._appGuid,instanceGuid:this._instanceGuid});rawPostMessage(this,msg)}.bind(this));return promise.then(removePromise.bind(null,id,timeoutId),removePromise.bind(null,id,timeoutId))}function createError(error){error.path&&(error.message='"'+error.path+'" '+error.message);var err=new Error(error.message);return err.name=error.name,err.stack=error.stack,err}function removePromise(id,timeoutId,args){if(clearTimeout(timeoutId),delete pendingPromises[id],args instanceof Error)throw args;return args}function isValidEvent(client,event){return client&&client._origin===event.origin&&client._source===event.source}function triggerEvent(client,eventName,data){return!!client._messageHandlers[eventName]&&void client._messageHandlers[eventName].forEach(function(handler){handler(data)})}function finalizePendingPromise(pendingPromise,data){if(data.error){var error=data.error.name?createError(data.error):data.error;pendingPromise.reject(error)}else pendingPromise.resolve(data.result)}function postReplyWith(client,key,msg){if(!client._repliesPending[key])return msg.key="iframe.reply:"+key,client._repliesPending[key]=!0,when(client._messageHandlers[key]).then(rawPostMessage.bind(null,client,msg))["catch"](function(reason){var rejectMessage=reason instanceof Error?reason.message:reason;msg.error={msg:rejectMessage},rawPostMessage(client,msg)}).then(function(){delete client._repliesPending[key]})}function getMessageRecipient(client,recipientGuid){var messageRecipient=client;if(recipientGuid&&recipientGuid!==client._instanceGuid&&(messageRecipient=client._instanceClients[recipientGuid],!messageRecipient))throw Error("[ZAF SDK] Could not find client for instance "+recipientGuid);return messageRecipient}function messageHandler(client,event){if(isValidEvent(client,event)){var data=event.data;if(data){if("string"==typeof data)try{data=JSON.parse(event.data)}catch(e){return e}var pendingPromise,clientRecipient=getMessageRecipient(client,data.instanceGuid);if(data.id&&(pendingPromise=pendingPromises[data.id]))finalizePendingPromise(pendingPromise,data);else if(ZAF_EVENT.test(data.key)){var key=data.key.replace(ZAF_EVENT,""),msg={appGuid:client._appGuid};if(data.needsReply)return postReplyWith(clientRecipient,key,msg);triggerEvent(clientRecipient,key,data.message)}}}}function processResponse(path,result){var isSingularOperation="string"==typeof path;if(!isSingularOperation)return result;var err=result.errors&&result.errors[path];if(err)throw createError(err);return result}var PROMISE_TIMEOUT=5e3,PROMISE_DONT_TIMEOUT=["instances.create"],ZAF_EVENT=/^zaf\./,version=require("version"),Utils=require("utils"),Promise=window.Promise||require("../vendor/native-promise-only"),when=require("utils").when,pendingPromises={},ids={},Client=function(options){return this._parent=options.parent,this._origin=options.origin||this._parent&&this._parent._origin,this._source=options.source||this._parent&&this._parent._source||window.parent,this._appGuid=options.appGuid||this._parent&&this._parent._appGuid,this._instanceGuid=options.instanceGuid||this._appGuid,this._messageHandlers={},this._repliesPending={},this._instanceClients={},this._metadata=null,this._context=options.context||null,this.ready=!1,this.on("app.registered",function(data){this.ready=!0,this._metadata=data.metadata,this._context=data.context},this),this.on("context.updated",function(context){this._context=context},this),this._parent?(this.ready=this._parent.ready,this):(window.addEventListener("message",messageHandler.bind(null,this)),void this.postMessage("iframe.handshake",{version:version}))};Client.prototype={postMessage:function(name,data){var msg=JSON.stringify({key:name,message:data,appGuid:this._appGuid,instanceGuid:this._instanceGuid});rawPostMessage(this,msg,"iframe.handshake"===name)},on:function(name,handler,context){"function"==typeof handler&&(handler=context?handler.bind(context):handler,this._messageHandlers[name]=this._messageHandlers[name]||[],this._messageHandlers[name].push(handler),"app.registered"!==name&&this.postMessage("iframe.on:"+name,{subscriberCount:this._messageHandlers[name].length}))},off:function(name,handler){if(!this._messageHandlers[name])return!1;var index=this._messageHandlers[name].indexOf(handler);return this.has(name,handler)&&this._messageHandlers[name].splice(index,1),this.postMessage("iframe.off:"+name,{subscriberCount:this._messageHandlers[name].length}),handler},has:function(name,handler){return!!this._messageHandlers[name]&&this._messageHandlers[name].indexOf(handler)!==-1},trigger:function(name,data){this.postMessage("iframe.trigger:"+name,data)},request:function(options){if(this._parent)return this._parent.request(options);var requestKey="request:"+nextIdFor("request");return new Promise(function(resolve,reject){"string"==typeof options&&(options={url:options}),this.on(requestKey+".done",function(evt){resolve.apply(this,evt.responseArgs)}),this.on(requestKey+".fail",function(evt){reject.apply(this,evt.responseArgs)}),this.postMessage(requestKey,options)}.bind(this))},instance:function(instanceGuid){if(!instanceGuid||"string"!=typeof instanceGuid)throw new Error("The instance method expects an `instanceGuid` string.");if(instanceGuid===this._instanceGuid)return this;if(this._parent)return this._parent.instance(instanceGuid);var instanceClient=this._instanceClients[instanceGuid];return instanceClient||(instanceClient=new Client({parent:this,instanceGuid:instanceGuid}),this._instanceClients[instanceGuid]=instanceClient),instanceClient},metadata:function(){return this._parent?this._parent.metadata():new Promise(function(resolve){this._metadata?resolve(this._metadata):this.on("app.registered",function(){resolve(this._metadata)}.bind(this))}.bind(this))},context:function(){if(this._context)return Promise.resolve(this._context);if(this._instanceGuid&&this._instanceGuid!=this._appGuid){var key="instances."+this._instanceGuid;return this.get(key).then(function(data){return this._context=data[key],this._context}.bind(this))}return new Promise(function(resolve){this.on("app.registered",function(data){resolve(data.context)})}.bind(this))},get:function(path){var paths=Array.isArray(path)?path:[path];if(arguments.length>1||paths.some(function(s){return"string"!=typeof s}))throw new Error("The get method accepts a string or array of strings.");return wrappedPostMessage.call(this,"get",paths).then(processResponse.bind(null,path))},set:function(key,val){var obj=key;if("string"==typeof key){if(1===arguments.length)throw new Error("The setter requires a value");obj={},obj[key]=val}if(!Utils.isObject(obj)||Array.isArray(obj))throw new Error("The set method accepts a key and value pair, or an object of key and value pairs.");return wrappedPostMessage.call(this,"set",obj).then(processResponse.bind(null,key))},invoke:function(key){var obj=key;if("string"!=typeof key)throw new Error("Invoke only supports string arguments.");return obj={},obj[key]=Array.prototype.slice.call(arguments,1),wrappedPostMessage.call(this,"invoke",obj).then(processResponse.bind(null,key))}},module.exports=Client},"vendor/native-promise-only.js":function(module,exports,require){!function(name,context,definition){context[name]=context[name]||definition(),"undefined"!=typeof module&&module.exports?module.exports=context[name]:"function"==typeof define&&define.amd&&define(function(){return context[name]})}("Promise","undefined"!=typeof global?global:this,function(){"use strict";function schedule(fn,self){scheduling_queue.add(fn,self),cycle||(cycle=timer(scheduling_queue.drain))}function isThenable(o){var _then,o_type=typeof o;return null==o||"object"!=o_type&&"function"!=o_type||(_then=o.then),"function"==typeof _then&&_then}function notify(){for(var i=0;i<this.chain.length;i++)notifyIsolated(this,1===this.state?this.chain[i].success:this.chain[i].failure,this.chain[i]);this.chain.length=0}function notifyIsolated(self,cb,chain){var ret,_then;try{cb===!1?chain.reject(self.msg):(ret=cb===!0?self.msg:cb.call(void 0,self.msg),ret===chain.promise?chain.reject(TypeError("Promise-chain cycle")):(_then=isThenable(ret))?_then.call(ret,chain.resolve,chain.reject):chain.resolve(ret))}catch(err){chain.reject(err)}}function resolve(msg){var _then,self=this;if(!self.triggered){self.triggered=!0,self.def&&(self=self.def);try{(_then=isThenable(msg))?schedule(function(){var def_wrapper=new MakeDefWrapper(self);try{_then.call(msg,function(){resolve.apply(def_wrapper,arguments)},function(){reject.apply(def_wrapper,arguments)})}catch(err){reject.call(def_wrapper,err)}}):(self.msg=msg,self.state=1,self.chain.length>0&&schedule(notify,self))}catch(err){reject.call(new MakeDefWrapper(self),err)}}}function reject(msg){var self=this;self.triggered||(self.triggered=!0,self.def&&(self=self.def),self.msg=msg,self.state=2,self.chain.length>0&&schedule(notify,self))}function iteratePromises(Constructor,arr,resolver,rejecter){for(var idx=0;idx<arr.length;idx++)!function(idx){Constructor.resolve(arr[idx]).then(function(msg){resolver(idx,msg)},rejecter)}(idx)}function MakeDefWrapper(self){this.def=self,this.triggered=!1}function MakeDef(self){this.promise=self,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function Promise(executor){if("function"!=typeof executor)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var def=new MakeDef(this);this.then=function(success,failure){var o={success:"function"!=typeof success||success,failure:"function"==typeof failure&&failure};return o.promise=new this.constructor(function(resolve,reject){if("function"!=typeof resolve||"function"!=typeof reject)throw TypeError("Not a function");o.resolve=resolve,o.reject=reject}),def.chain.push(o),0!==def.state&&schedule(notify,def),o.promise},this["catch"]=function(failure){return this.then(void 0,failure)};try{executor.call(void 0,function(msg){resolve.call(def,msg)},function(msg){reject.call(def,msg)})}catch(err){reject.call(def,err)}}var builtInProp,cycle,scheduling_queue,ToString=Object.prototype.toString,timer="undefined"!=typeof setImmediate?function(fn){return setImmediate(fn)}:setTimeout;try{Object.defineProperty({},"x",{}),builtInProp=function(obj,name,val,config){return Object.defineProperty(obj,name,{value:val,writable:!0,configurable:config!==!1})}}catch(err){builtInProp=function(obj,name,val){return obj[name]=val,obj}}scheduling_queue=function(){function Item(fn,self){this.fn=fn,this.self=self,this.next=void 0}var first,last,item;return{add:function(fn,self){item=new Item(fn,self),last?last.next=item:first=item,last=item,item=void 0},drain:function(){var f=first;for(first=last=cycle=void 0;f;)f.fn.call(f.self),f=f.next}}}();var PromisePrototype=builtInProp({},"constructor",Promise,!1);return Promise.prototype=PromisePrototype,builtInProp(PromisePrototype,"__NPO__",0,!1),builtInProp(Promise,"resolve",function(msg){var Constructor=this;return msg&&"object"==typeof msg&&1===msg.__NPO__?msg:new Constructor(function(resolve,reject){if("function"!=typeof resolve||"function"!=typeof reject)throw TypeError("Not a function");resolve(msg)})}),builtInProp(Promise,"reject",function(msg){return new this(function(resolve,reject){if("function"!=typeof resolve||"function"!=typeof reject)throw TypeError("Not a function");reject(msg)})}),builtInProp(Promise,"all",function(arr){var Constructor=this;return"[object Array]"!=ToString.call(arr)?Constructor.reject(TypeError("Not an array")):0===arr.length?Constructor.resolve([]):new Constructor(function(resolve,reject){if("function"!=typeof resolve||"function"!=typeof reject)throw TypeError("Not a function");var len=arr.length,msgs=Array(len),count=0;iteratePromises(Constructor,arr,function(idx,msg){msgs[idx]=msg,++count===len&&resolve(msgs)},reject)})}),builtInProp(Promise,"race",function(arr){var Constructor=this;return"[object Array]"!=ToString.call(arr)?Constructor.reject(TypeError("Not an array")):new Constructor(function(resolve,reject){if("function"!=typeof resolve||"function"!=typeof reject)throw TypeError("Not a function");iteratePromises(Constructor,arr,function(idx,msg){resolve(msg)},reject)})}),Promise})}},ZAFClient=require("index.js")}();
//# sourceMappingURL=zaf_sdk.min.js.map